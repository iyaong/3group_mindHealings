# 매칭 시스템 권유 모달 구현 가이드

## 📋 개요

다이어리 페이지에서 감정 진단이 완료되면 사용자에게 매칭 시스템 이용을 권유하는 모달을 표시합니다.

## ✨ 주요 기능

### 1. 자동 표시 조건
- **트리거**: 5개 이상의 메시지가 쌓이고 감정 분석이 완료되었을 때
- **타이밍**: 진단 완료 애니메이션이 끝난 후 자동으로 표시
- **빈도**: 한 세션당 한 번만 표시 (중복 방지)

### 2. 모달 구성 요소

#### 헤더
- 감정 색상으로 강조된 아이콘 (💬)
- 닫기 버튼 (우측 상단)

#### 내용
- **제목**: "감정 진단이 완료되었어요! 🎉"
- **현재 감정 표시**: 감정명과 색상
- **감정별 맞춤 메시지**:
  - 기쁨: "기쁜 마음을 다른 분들과 나누어 보는 건 어떨까요?"
  - 슬픔: "비슷한 감정을 느끼는 분들과 이야기를 나누면 위로가 될 거예요."
  - 불안: "같은 고민을 가진 분들과 소통하면 마음이 편안해질 수 있어요."
  - 화남: "감정을 이해해주는 분들과 이야기하면 도움이 될 거예요."
  - 평온: "평온한 마음을 나누며 다른 분들에게도 좋은 영향을 줄 수 있어요."

#### 주요 기능 소개 (3가지)
1. 🎯 비슷한 감정을 가진 사람과 매칭
2. 🔒 익명으로 안전하게 대화
3. 💝 서로에게 위로와 공감 전달

#### 액션 버튼
1. **매칭 시스템 이용하기** (주 버튼)
   - 감정 색상으로 강조
   - 클릭 시 `/online` 페이지로 이동
2. **나중에 할게요** (부 버튼)
   - 클릭 시 모달만 닫기

## 🎨 디자인 특징

### 애니메이션
- **오버레이**: 페이드 인 (0.3초)
- **모달**: 슬라이드 업 + 스케일 (0.4초, 바운스 효과)
- **아이콘**: 바운스 애니메이션 (0.6초)
- **호버 효과**: 버튼과 기능 항목에 부드러운 전환

### 색상 시스템
- 주 버튼: 사용자의 현재 감정 색상 적용
- 모달 배경: 흰색 with 그림자
- 오버레이: 반투명 검정 + blur 효과

### 반응형 디자인
- 데스크탑: 최대 너비 480px
- 모바일: 전체 너비, 패딩 조정, 아이콘/텍스트 크기 축소

### 접근성
- `prefers-reduced-motion` 지원
- 키보드 네비게이션 가능
- 명확한 닫기 옵션

## 📂 파일 구조

```
src/
├── components/
│   ├── MatchingSuggestionModal.tsx    # 모달 컴포넌트
│   └── MatchingSuggestionModal.css    # 모달 스타일
└── pages/
    └── Diary.tsx                       # 모달 통합 (import 및 렌더링)
```

## 🔧 구현 세부사항

### 1. MatchingSuggestionModal.tsx

```typescript
interface MatchingSuggestionModalProps {
  emotion: string;      // 현재 감정명
  color: string;        // 현재 감정 색상
  onClose: () => void;  // 닫기 콜백
}
```

**주요 함수**:
- `getMessage()`: 감정에 따른 맞춤 메시지 반환
- `handleGoToMatching()`: 온라인 페이지로 이동
- `handleStayInDiary()`: 모달 닫기

### 2. Diary.tsx 통합

**상태 관리**:
```typescript
const [showMatchingSuggestion, setShowMatchingSuggestion] = useState(false);
```

**표시 로직** (send 함수 내):
```typescript
// 최소 메시지 도달 시 토스트 알림 + 진단 완료 애니메이션
const newCanAnalyze = newMessageCount >= MIN_REQUIRED_MESSAGES;
if (newCanAnalyze && !prevCanAnalyze && newMood) {
    showToast({
        message: '✨ 충분한 대화가 쌓였어요! 전체 감정 분석이 완료되었습니다.',
        type: 'success',
        duration: 4000
    });

    // 진단 완료 애니메이션 표시
    setShowCompletedAnimation(true);
    setTimeout(() => {
        setShowCompletedAnimation(false);
    }, 2000);

    // 매칭 제안 대화창 표시
    setShowMatchingSuggestion(true);
}
```

**렌더링**:
```tsx
{showMatchingSuggestion && mood && (
    <MatchingSuggestionModal
        emotion={mood.emotion}
        color={mood.color}
        onClose={() => setShowMatchingSuggestion(false)}
    />
)}
```

## 🎯 사용자 경험 플로우

1. **대화 시작**: 사용자가 AI와 대화 시작
2. **진행 추적**: 메시지 카운터가 증가 (최소 5개 필요)
3. **자동 분석**: 5번째 메시지 이후 자동으로 감정 분석 실행
4. **진단 완료**: 
   - 토스트 알림 표시 (4초)
   - 진단 완료 애니메이션 (2초)
5. **모달 표시**: 매칭 시스템 권유 모달 자동 표시
6. **사용자 선택**:
   - **Option A**: "매칭 시스템 이용하기" → `/online` 페이지로 이동
   - **Option B**: "나중에 할게요" → 모달 닫기, 다이어리 계속 작성
   - **Option C**: 배경 클릭 또는 X 버튼 → 모달 닫기

## 🔍 테스트 방법

### 기본 테스트
1. 다이어리 페이지 접속
2. AI와 5개 이상의 메시지 주고받기
3. 자동으로 감정 분석 완료 확인
4. 매칭 권유 모달이 표시되는지 확인

### 기능 테스트
- ✅ "매칭 시스템 이용하기" 버튼 → 온라인 페이지로 이동
- ✅ "나중에 할게요" 버튼 → 모달만 닫힘
- ✅ X 버튼 → 모달 닫힘
- ✅ 배경 클릭 → 모달 닫힘
- ✅ 감정별 다른 메시지 표시
- ✅ 감정 색상이 버튼과 아이콘에 적용

### 반응형 테스트
- 데스크탑 (1920px)
- 태블릿 (768px)
- 모바일 (375px)

### 접근성 테스트
- 키보드 네비게이션 (Tab, Enter, Escape)
- 스크린 리더 호환성
- 애니메이션 감소 설정 존중

## 🚀 향후 개선 사항

### 단기 개선
- [ ] 모달 표시 빈도 제어 (하루에 한 번만 표시 등)
- [ ] 사용자가 "다시 보지 않기" 옵션 추가
- [ ] 매칭 성공률 데이터 표시

### 중기 개선
- [ ] A/B 테스트를 통한 문구 최적화
- [ ] 현재 대기 중인 사용자 수 표시
- [ ] 매칭 예상 대기 시간 표시

### 장기 개선
- [ ] 매칭 후기 및 평점 표시
- [ ] 추천 대화 주제 제안
- [ ] 매칭 전 간단한 온보딩

## 📊 기대 효과

### 사용자 경험
- ✨ 감정 진단 완료 후 자연스러운 다음 단계 제시
- 💬 매칭 시스템 인지도 향상
- 🎯 감정 기반 매칭의 가치 전달

### 비즈니스 지표
- 📈 매칭 시스템 이용률 증가 예상 (20-30%)
- 👥 사용자 참여도 향상
- 🔄 재방문율 증가

## 🛠️ 기술 스택

- **React 19**: 컴포넌트 기반 UI
- **TypeScript**: 타입 안전성
- **CSS3**: 애니메이션 및 반응형 디자인
- **React Router**: 페이지 네비게이션

## 📝 커밋 메시지

```
feat: 감정 진단 완료 후 매칭 시스템 권유 모달 추가

- MatchingSuggestionModal 컴포넌트 생성
- 감정별 맞춤 메시지 제공
- 주요 기능 3가지 소개
- 매칭 시스템으로 즉시 이동 가능
- 애니메이션 및 반응형 디자인 적용
- 접근성 고려 (키보드, 애니메이션 감소)

목적: 감정 진단 완료 후 자연스럽게 매칭 시스템 이용 유도
효과: 매칭 시스템 이용률 20-30% 증가 예상
```

---

**구현 완료일**: 2025년 11월 10일  
**담당자**: GitHub Copilot  
**상태**: ✅ 완료 및 테스트 준비
